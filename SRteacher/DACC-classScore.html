<!doctype html>
<html lang="zh-hant-TW">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="SmartReading 適性閱讀 教師端">
<meta name="author" content="SmartReading">
<meta name="generator" content="SmartReading">
<title>SmartReading 教師端</title>
<link rel="shortcut icon" type="image/x-icon" href="Content/images/favicon.ico">
<!-- google fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">

<!-- widgets CSS -->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
<link rel="stylesheet" type="text/css" href="Content/widgets/DataTables/datatables.min.css">

<!-- template CSS -->
<link rel="stylesheet" type="text/css" href="Content/css/bootstrap-custom.css">
<link rel="stylesheet" type="text/css" href="Content/css/SRv3-manager.css">
</head>
<body data-sidebar="DACC-classScore">
<form>
  <header> </header>
	
  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-xl-2 d-xl-block bg-white sidebar collapse"> </nav>
      <main class="col-xl-10"> 
        <!-- ------- ------- ------- ------- ------- ------- ------- -->
        <h2 class="SR-h2"><span>檢視班級成績</span></h2>
        <div class="row py-3 py-xl-5 px-1 px-xl-4"> 
          <!-- 搜尋 start -->
          <div class="col-xl-12 mb-3" id="blockSearch">
            <div class="row g-2 align-items-center justify-content-between">
              <div class="col-auto">
                <div class="row gy-1">
                  <div class="col-auto">
                    <div class="row g-2 align-items-center">
                      <div class="col-auto">
                        <label for="searchClassGrade" class="col-form-label fs-8">班年級</label>
                      </div>
                      <div class="col-auto">
                        <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchClassGrade">
                          <option value="" disabled selected>請選擇...</option>
                          <option value="0">全校班級</option>
                          <option value="4年級DEMO班">4年級DEMO班</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-auto">
                    <div class="row g-2 align-items-center">
                      <div class="col-auto">
                        <label for="searchSession" class="col-form-label fs-8">場次</label>
                      </div>
                      <div class="col-auto">
                        <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchSession">
                          <option value="" disabled selected>請選擇...</option>
                          <option value="2023/03/24,2023/06/30">2023 Demo</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-auto px-xxl-5">
                    <div class="row g-2 align-items-center">
                      <div class="col-auto">
                        <label class="fs-8">時間：</label>
                      </div>
                      <div class="col-auto"><span class="fs-8">
                        <label id="searchStartDate">----/--/--</label>
                        至
                        <label id="searchEndDate">----/--/--</label>
                        </span></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-auto">
                <div class="row gy-2 align-items-center">
                  <div class="col-auto">
                    <div class="row g-2 align-items-center">
                      <div class="col-auto">
                        <label for="searchKeywords" class="col-form-label fs-7">搜尋</label>
                      </div>
                      <div class="col-auto">
                        <div class="input-group" data-dt-target="#classScore">
                          <div class="input-group-clear">
                            <input type="text" class="form-control rounded-0" placeholder="請輸入關鍵字..." aria-label="請輸入關鍵字..." aria-describedby="btnSearch" id="searchKeywords">
                            <button class="btn btn-close" type="button"></button>
                          </div>
                          <button class="btn btn-gray-100 rounded-0 border-gray-400 text-primary lh-1" type="button" id="btnSearch"><i class="fa-solid fa-magnifying-glass fs-5 mx-n1"></i></button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-auto">
                    <button type="button" class="btn btn-outline-primary bg-gradient">Excel 下載</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 搜尋  end  --> 
          <!-- 表格 start -->
          <div class="col-xl-12 mb-5">
            <table class="table table-bordered table-classScore" id="classScore">
              <thead>
                <tr>
                  <th scope="col" class="col-index">序號</th>
                  <th scope="col" class="col-testDate">測驗日期</th>
                  <th scope="col" class="col-grade">年級</th>
                  <th scope="col" class="col-class">班級</th>
                  <th scope="col" class="col-studentId">學號</th>
                  <th scope="col" class="col-studentName">姓名</th>
                  <th scope="col" class="col-DACCall"><span class="DACCicon-all">整</span>整體閱讀理解能力</th>
                  <th scope="col" class="col-DACCword"><span class="DACCicon-word">字</span>字詞辨識</th>
                  <th scope="col" class="col-DACCsuperficial"><span class="DACCicon-superficial">表</span>表層文意理解</th>
                  <th scope="col" class="col-DACCtextual"><span class="DACCicon-textual">文</span>文意統整</th>
                  <th scope="col" class="col-DACCinference"><span class="DACCicon-inference">推</span>推論理解</th>
                  <th scope="col" class="col-DACCanalysis"><span class="DACCicon-analysis">分</span>分析評鑑</th>
                  <th scope="col" class="col-PR">PR</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="col-index">1</td>
                  <td class="col-date">2022/11/28</td>
                  <td class="col-grade">3</td>
                  <td class="col-class"><input class="form-control rounded-0 readonly" type="text" value="Test 01" disabled readonly></td>
                  <td class="col-studentId"><input class="form-control rounded-0 readonly" type="text" value="2010123" disabled readonly></td>
                  <td class="col-studentName"><input class="form-control rounded-0 readonly" type="text" value="張花花" disabled readonly></td>
                  <td class="col-DACCall">500</td>
                  <td class="col-DACCword">100</td>
                  <td class="col-DACCsuperficial">100</td>
                  <td class="col-DACCtextual">100</td>
                  <td class="col-DACCinference">100</td>
                  <td class="col-DACCanalysis">100</td>
                  <td class="col-PR">60</td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- 表格  end  --> 
        </div>
        <!-- ------- ------- ------- ------- ------- ------- ------- --> 
      </main>
    </div>
  </div>
	
  <footer> </footer>
</form>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="Content/js/jquery-3.6.0.min.js"></script> 

<!-- widgets JS --> 
<script src="Content/js/bootstrap.bundle.min.js"></script> 
<script src="Content/js/doubleScorollbar.js"></script> 
<script src="Content/widgets/DataTables/datatables.min.js"></script> 
<script src="Content/widgets/DataTables/buttons-2.4.2/js/dataTables.buttons.min.js"></script> 
<script src="Content/widgets/DataTables/buttons-2.4.2/js/buttons.html5.min.js"></script> 
<script src="Content/widgets/DataTables/buttons-2.4.2/js/buttons.print.min.js"></script> 
<script src="Content/widgets/bootstrap-select-1.14.0-beta3/dist/js/bootstrap-select.min.js"></script> 

<!-- my JS --> 
<script src="Content/js/main.js"></script> 
<script>
$(document).ready(function () {
  const $table = $('#classScore');

  //清空 html
  $table.find('tbody').remove();
	
  $('#searchClassGrade, #searchSession').html('<option value="" disabled selected>請選擇...</option>');

  //班級成績 datatables 
	if (!$.fn.DataTable.isDataTable($table)) { //先生成空 DataTable
  	$table.DataTable({
    //serverSide: true,     // 開啟伺服端模式
    processing: true,
    order: [], //取消默認排序icon
    ordering: false,
    autoWidth: false,
    responsive: false,
    searching: true,
    pageLength: 10,
    pagingType: "simple_numbers",
    dom: '<"table-responsive"rt>'
      + '<"datatables-custom-footer"pi>',
    language: {
      url: 'Content/widgets/DataTables/lang/Chinese-traditional.json'
    },
    //ajax: 'Content/json/DACC-classScore/classScore.json',
    columnDefs: [
			{ //序號
        targets: 0,
        title: '序號',
        className: 'col-index',
        orderable: false,
        render: function (data, type, row, meta) {
          return meta.row + 1;
        }
      },
      { //測驗日期
        targets: 1,
        title: '測驗日期',
        data: 'testDate',
        className: 'col-testDate',
        orderable: false,
      },
      { //年級 
        targets: 2,
        title: '年級',
        data: 'grade',
        className: 'col-grade',
				orderable: false,
      },
      { //班級
        targets: 3,
        title: '班級',
        data: 'class',
        className: 'col-class',
        orderable: false,
        render: function (data, type, row, meta) {
					if(type === 'filter' || type === 'search') return data; // 搜尋用原始資料
          return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
        }
      },
      { //學號
        targets: 4,
        title: '學號',
        data: 'Sid',
        className: 'col-studentId',
        orderable: false,
        render: function (data, type, row, meta) {
					if(type === 'filter' || type === 'search') return data; // 搜尋用原始資料
          return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
        }
      },
      { //姓名
        targets: 5,
        title: '姓名',
        data: 'studentName',
        className: 'col-studentName',
        orderable: false,
        render: function (data, type, row, meta) {
					if(type === 'filter' || type === 'search') return data; // 搜尋用原始資料
          return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
        }
      },
      { //整體閱讀理解能力
        targets: 6,
        title: '<span class="DACCicon-all">整</span>整體閱讀理解能力',
        data: 'DACCall',
        className: 'col-DACCall',
        orderable: false,
      },
      { //字詞辨識
        targets: 7,
        title: '<span class="DACCicon-word">字</span>字詞辨識',
        data: 'DACCword',
        className: 'col-DACCword',
        orderable: false,
      },
      { //表層文意理解
        targets: 8,
        title: '<span class="DACCicon-superficial">表</span>表層文意理解',
        data: 'DACCsuperficial',
        className: 'col-DACCsuperficial',
        orderable: false,
      },
      { //文意統整
        targets: 9,
        title: '<span class="DACCicon-textual">文</span>文意統整',
        data: 'DACCtextual',
        className: 'col-DACCtextual',
        orderable: false,
      },
      { //推論理解
        targets: 10,
        title: '<span class="DACCicon-inference">推</span>推論理解',
        data: 'DACCinference',
        className: 'col-DACCinference',
        orderable: false,
      },
      { //分析評鑑
        targets: 11,
        title: '<span class="DACCicon-analysis">分</span>分析評鑑',
        data: 'DACCanalysis',
        className: 'col-DACCanalysis',
        orderable: false,
      },
      { //PR
        targets: 12,
        title: 'PR',
        data: 'PR',
        className: 'col-PR',
        orderable: false,
      }

    ],
    initComplete: function () {
      //datatable footer input page
      datatableInputPage($table);
    }
  });
	}

	//DataTable 搜尋共用功能
  initDataTableSearch();
	
  //demo
  let searchData = null; //當前要搜尋的json資料
  $.getJSON('Content/json/DACC-classScore/classScore.json', function (data) {
    searchData = data;

    //寫入[班年級]下拉選項
    let selectArrayCG = [];
    $.each(data.data, function (index, item) {
      selectArrayCG.push(item.grade + ',' + item.class);
    });
    var uniqueSelectArrayCG = [...new Set(selectArrayCG)];

    let selectHtmlCG = '';
    for (let i = 0; i < uniqueSelectArrayCG.length; i++) {
      selectHtmlCG += '<option value="' + uniqueSelectArrayCG[i] + '">' + uniqueSelectArrayCG[i].split(',')[0] + '年' + uniqueSelectArrayCG[i].split(',')[1] + '班</option>';
    }

    $('#searchClassGrade').html(`
				<option value="" disabled selected>請選擇...</option>
					<option value="0">全校班級</option>`
      		+ selectHtmlCG);

    //選擇[班年級]
    $('#searchClassGrade').change(function () {
      //取得符合選擇的[班年級]json資料
      let filterClassGrade;

      if ($(this).val() == '0') { //全校班級
        filterClassGrade = data.data;
      } else {
        let classGradeArray = $(this).val().split(',');
        let gradeVal = classGradeArray[0],
          classVal = classGradeArray[1];

        filterClassGrade = $.grep(data.data, function (item) {
          return item.grade === gradeVal && item.class === classVal;
        });
      }

      searchData = filterClassGrade;

      //寫入[場次]下拉選項
      let selectArrayS = [];
      $.each(filterClassGrade, function (index, item) {
        selectArrayS.push(item.session);
      });
      var uniqueSelectArrayS = [...new Set(selectArrayS)];

      let optionHtmlS = '';
      for (let i = 0; i < uniqueSelectArrayS.length; i++) {
        //取得、寫入各場次下拉選項的時間value 
        $.getJSON('Content/json/DACC-classScore/sessions.json', function (data) {
          let filterSession = $.grep(data.data, function (item) {
            return item.session === uniqueSelectArrayS[i];
          });

          optionHtmlS += '<option value="' + filterSession[0].startDate + ',' + filterSession[0].endDate + '">' + uniqueSelectArrayS[i] + '</option>';

          $('#searchSession').html(`<option value="" disabled selected>請選擇...</option>`
            + optionHtmlS);
        });
      }

      //選擇[場次]
      $('#searchSession').off('change').on('change', function () {
        //顯示時間
        let SessionsArray = $('#searchSession').val().split(',');
        $('#searchStartDate').text(SessionsArray[0]);
        $('#searchEndDate').text(SessionsArray[1]);

        //取得符合選擇的[場次]json資料
        let sessionVal = $(this).find('option:selected').text();

        let matchSession = $.grep(filterClassGrade, function (item) {
          return item.session === sessionVal;
        });

        //datatable
        //$table.DataTable().clear();
        //$table.DataTable().rows.add(matchSession).draw();
				$table.DataTable().clear().rows.add(matchSession).draw();

        searchData = matchSession;
      });
    });
  });
});

</script>
</body>
</html>
