<!doctype html>
<html lang="zh-hant-TW">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="smartreading-XXXX">
<meta name="author" content="smartreading">
<meta name="generator" content="smartreading">
<title>SmartReading 教師端</title>
<link rel="shortcut icon" type="image/x-icon" href="Content/images/favicon.ico">
<!-- google fonts -->	
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">	
	
<!-- widgets CSS -->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
<link rel="stylesheet" type="text/css" href="Content/widgets/DataTables/datatables.min.css">

<!-- template CSS -->
<link rel="stylesheet" type="text/css" href="Content/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="Content/css/SRv3-manager.css">
</head>
<body>
<header> </header>
<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-xl-2 d-xl-block bg-white sidebar collapse"> </nav>
    <main class="col-xl-10"> 
      <!-- ------- ------- ------- ------- ------- ------- ------- -->
      <h2>測驗場次管理</h2>
      <div class="row py-3 py-xl-5 px-1 px-xl-4">
        <!-- 按鈕 start -->
        <div class="col-xxl-5 mb-3" id="blockBtns">
          <button type="button" class="btn btn-outline-primary bg-gradient my-1" id="insert"><i class="fa-solid fa-plus me-1"></i>新增場次</button>
        </div>
        <!-- 按鈕  end  --> 
        <!-- 搜尋 start -->
        <div class="col-xxl-7 mb-3" id="blockSearch">
          <div class="row g-2 align-items-center justify-content-end">
            <div class="col-auto">
              <label for="searchState" class="col-form-label fs-7">狀態</label>
            </div>
            <div class="col-auto">
              <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchState">
                <option value="" selected>全部</option>
                <option value="ON">ON</option>
                <option value="OFF">OFF</option>
              </select>
            </div>
            <div class="col-auto d-none d-lg-inline ms-3">
              <label for="searchKeywords" class="col-form-label fs-7">搜尋</label>
            </div>
            <div class="col-auto">
              <div class="input-group">
                <div class="input-group-clear">
                  <input type="text" class="form-control rounded-0" placeholder="請輸入關鍵字..." aria-label="請輸入關鍵字..." aria-describedby="btnSearch" id="searchKeywords">
                  <button class="btn btn-close" type="button"></button>
                </div>
                <button class="btn btn-gray-100 rounded-0 border-gray-400 text-primary lh-1" type="button" id="btnSearch"><i class="fa-solid fa-magnifying-glass fs-5 mx-n1"></i></button>
              </div>
            </div>
          </div>
        </div>
        <!-- 搜尋  end  --> 
        <!-- 表格 start -->
        <div class="col-xl-12 mb-5">
          <table class="table table-bordered SRtable table-sessionLists" id="sessionLists">
            <thead>
              <tr>
                <th scope="col" class="td-no">序號</th>
                <th scope="col" class="td-session">場次</th>
                <th scope="col" class="td-remark">備註</th>
                <th scope="col" class="td-startTime">開始時間</th>
                <th scope="col" class="td-endTime">結束時間</th>
                <th scope="col" class="td-testNum">測驗人數</th>
                <th scope="col" class="td-doneNum">完成人數</th>
                <th scope="col" class="td-tools">功能操作</th>
                <th scope="col" class="td-state">狀態</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="td-no">1</td>
                <td class="td-sessio"><input type="text" class="form-control rounded-0 readonly" value="2020-21" disabled readonly></td>
                <td class="td-remark"><input type="text" class="form-control rounded-0 readonly" value="淡水國小" disabled readonly></td>
                <td class="td-startTime">2020/09/01 08:00</td>
                <td class="td-endTime">2020/12/31 17:30</td>
                <td class="td-testNum">22</td>
                <td class="td-doneNum">22</td>
                <td class="td-tools"><button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-studentSet" data-bs-toggle="tooltip"><img src="Content/images/icon-user-add.svg" alt="button studentSet image"/></button>
                  <button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-studentLists" data-bs-toggle="tooltip"><img src="Content/images/icon-paper.svg" alt="button studentLists image"/></button>
                  <button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-sessionSet" data-bs-toggle="tooltip"><img src="Content/images/icon-tool.svg" alt="button sessionSet image"/></button></td>
                <td class="td-state"><div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch">
                  </div></td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- 表格  end  --> 
        <!-- [修改資料]-訊息 start -->
        <div class="col-xl-12 text-center text-red fs-8 mb-2" id="blockEditMsg">
          <!--錯誤訊息在這-->
        </div>
        <!-- [修改資料]-訊息  end  --> 
        <!-- [修改資料]-按鈕 start -->
        <div class="col-xl-12 text-center mb-5" id="blockEditBtns" style="display: none;">
          <div>
            <button type="button" class="btn btn-outline-primary m-1" id="editCancel">取消</button>
            <button type="button" class="btn btn-primary m-1" id="editOk">確定修改</button>
          </div>
        </div>
        <!-- [修改資料]-按鈕  end  -->
      </div>
      <!-- ------- ------- ------- ------- ------- ------- ------- --> 
    </main>
  </div>
</div>

<!-- Modal#insertModal 新增場次 start -->
<div class="modal fade" id="insertModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="insertModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-0">
      <div class="modal-header">
        <button type="button" class="btn-close float-start" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- 新增場次 start -->
        <div class="mb-3 row">
          <h3 class="text-center h6">新增場次</h3>
        </div>
        <div class="SRform mb-4 col-lg-10 mx-auto" id="">
          <div class="mb-3 row align-items-center">
            <label for="insertSessionName" class="col-sm-4 col-form-label text-sm-end">場次名稱<span class="text-red">*</span></label>
            <div class="col-sm-6">
              <input type="text" class="form-control rounded-0" id="insertSessionName">
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <label for="insertRemark" class="col-sm-4 col-form-label text-sm-end" value="zhanghuahua">場次備註</label>
            <div class="col-sm-6">
              <input type="text" class="form-control rounded-0" id="insertRemark">
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <label for="insertStartTime" class="col-sm-4 col-form-label text-sm-end">開始時間<span class="text-red">*</span></label>
            <div class="col-sm-6">
              <input type="datetime-local" class="form-control rounded-0" id="insertStartTime">
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <label for="insertEndTime" class="col-sm-4 col-form-label text-sm-end">結束時間<span class="text-red">*</span></label>
            <div class="col-sm-6">
              <input type="datetime-local" class="form-control rounded-0" id="insertEndTime">
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <label for="insertState" class="col-sm-4 col-form-label text-sm-end">狀態</label>
            <div class="col-sm-6">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch">
              </div>
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <div class="col-sm-6 offset-sm-4">
              <div class="text-red text-center fs-8 mb-n2" id="insertSessionMsg">
                <!--錯誤訊息在這-->
              </div>
            </div>
          </div>
          <div class="mb-3 row align-items-center">
            <div class="col-sm-6 offset-sm-4 text-center">
              <button type="button" class="btn btn-outline-primary m-1" data-bs-dismiss="modal">取消</button>
              <button type="button" class="btn btn-primary m-1" id="insertSession">確定新增</button>
            </div>
          </div>
        </div>
        <!-- 新增場次  end  -->
      </div>
    </div>
  </div>
</div>
<!-- Modal#insertModal 新增場次  end  --> 

<!-- Modal#studentSetModal 設定學生 start -->
<div class="modal fade" id="studentSetModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="studentSetModal" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-0">
      <div class="modal-header">
        <button type="button" class="btn-close float-start" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row px-2 justify-content-center">
          <!-- 設定學生 start -->
          <div class="mb-3 row">
            <h3 class="text-center h6">設定學生</h3>
          </div>
          <!-- 手風琴 start -->
          <div class="col-xl-12  mb-5">
            <div class="accordion SRaccordion accordion-StudentSet" id="accordionStudentSet">
              <!-- *年級 start -->
              <div class="accordion-item">
                <h4 class="accordion-header"> <!--<span class="form-check-inline SRform-check-red me-2">
                  <input class="form-check-input my-0" type="checkbox" name="checkAll">
                  </span>-->
                  <button class="accordion-button collapsed bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4" aria-expanded="false" aria-controls="collapse4">4年級 </button>
                </h4>
                <div id="collapse4" class="accordion-collapse collapse">
                  <div class="accordion-body">
                    <!-- 表格 start -->
                    <div class="table-responsive">
                      <table class="table table-bordered SRtable mb-0 table-studentSet" id="studentSet4-1">
                        <thead>
                          <tr>
                            <th scope="col" class="td-classCheck"> <span class="form-check-inline SRform-check-red me-2">
                              <input class="form-check-input" type="checkbox" name="checkAll">
                              </span>
                              <button class="table-collapse collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#studentSet4-1-tbody" aria-expanded="false" aria-controls="studentSet4-1-tbody">TEST 01班 </button>
                            </th>
                            <th scope="col" class="td-Cname">姓名</th>
                            <th scope="col" class="td-Sid">學號</th>
                            <th scope="col" class="td-account">帳號/信箱</th>
                          </tr>
                        </thead>
                        <tbody class="collapse" id="studentSet4-1-tbody">
                          <tr>
                            <td class="td-classCheck"><div class="SRform-check-red">
                                <input class="form-check-input" type="checkbox" name="check">
                              </div></td>
                            <td class="td-Cname"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                            <td class="td-Sid"><input type="text" class="form-control rounded-0 readonly" value="2020153" disabled readonly></td>
                            <td class="td-account"><input type="text" class="form-control rounded-0 readonly" value="srtt01@smartreading.com" disabled readonly></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- 表格  end  -->
                  </div>
                </div>
              </div>
              <!-- *年級  end  -->
            </div>
          </div>
          <!-- 手風琴  end  --> 
          <!-- 設定學生  end  -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal#studentSetModal 設定學生  end  --> 

<!-- Modal#studentListsModal 學生名單 start -->
<div class="modal fade" id="studentListsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="studentListsModal" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-0">
      <div class="modal-header">
        <button type="button" class="btn-close float-start" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row px-2 justify-content-center">
          <!-- 學生名單 start -->
          <div class="mb-3 row">
            <h3 class="text-center h6">學生名單</h3>
          </div>
          <!-- 搜尋 start -->
          <div class="col-xl-12 mb-3">
            <div class="row g-2 align-items-center">
              <div class="col-auto me-auto">
                <span class="fs-7 fw-semibold">場次：<label>2020-21</label></span>
              </div>
              <div class="col-auto ms-auto">
                <div class="row g-2">
                  <div class="col-auto d-none d-lg-inline ms-3">
                    <label for="searchKeywords_studentLists" class="col-form-label fs-7">搜尋</label>
                  </div>
                  <div class="col-auto">
                    <div class="input-group">
                      <div class="input-group-clear">
                        <input type="text" class="form-control rounded-0" placeholder="請輸入關鍵字..." aria-label="請輸入關鍵字..." aria-describedby="btnSearch_studentLists" id="searchKeywords_studentLists">
                        <button class="btn btn-close" type="button"></button>
                      </div>
                      <button class="btn btn-gray-100 rounded-0 border-gray-400 text-primary lh-1" type="button" id="btnSearch_studentLists"><i class="fa-solid fa-magnifying-glass fs-5 mx-n1"></i></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 搜尋  end  --> 
          <!-- 勾選 start -->
          <div class="col-xl-12 mb-3">
            <div class="form-check-inline SRform-check me-3 fs-7">
              <input class="form-check-input" type="checkbox" name="showList" id="showList-all" value="" checked>
              <label class="form-check-label" for="showList-all">顯示所有名單</label>
            </div>
            <div class="form-check-inline SRform-check me-3 fs-7">
              <input class="form-check-input" type="checkbox" name="showList" id="showList-done" value="<span>完成</span>">
              <label class="form-check-label" for="showList-done">僅顯示完成名單</label>
            </div>
            <div class="form-check-inline SRform-check me-3 fs-7">
              <input class="form-check-input" type="checkbox" name="showList" id="showList-undone" value="<span class='text-red'>未完成</span>">
              <label class="form-check-label" for="showList-undone">僅顯示未完成名單</label>
            </div>
          </div>
          <!-- 勾選  end  --> 
          <!-- 表格 start -->
          <div class="col-xl-12">
            <div class="table-responsive">
              <table class="table table-bordered SRtable table-sessionStudentLists" id="sessionStudentLists">
                <thead>
                  <tr>
                    <th scope="col" class="td-no">序號</th>
                    <th scope="col" class="td-grade">年級</th>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-Cname">姓名</th>
                    <th scope="col" class="td-Sid">學號</th>
                    <th scope="col" class="td-account">帳號/信箱</th>
                    <th scope="col" class="td-state">狀態</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-no">1</td>
                    <td class="td-grade"><input type="text" class="form-control rounded-0 readonly" value="5" disabled readonly></td>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="Test 01" disabled readonly></td>
                    <td class="td-Cname"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-Sid"><input type="text" class="form-control rounded-0 readonly" value="2020153" disabled readonly></td>
                    <td class="td-account"><input type="text" class="form-control rounded-0 readonly" value="srtt01@smartreading.com" disabled readonly></td>
                    <td class="td-state"><span class="text-red">未完成</span></td>
                  </tr>
                  <tr>
                    <td class="td-no">2</td>
                    <td class="td-grade"><input type="text" class="form-control rounded-0 readonly" value="5" disabled readonly></td>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="Test 01" disabled readonly></td>
                    <td class="td-Cname"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-Sid"><input type="text" class="form-control rounded-0 readonly" value="2020153" disabled readonly></td>
                    <td class="td-account"><input type="text" class="form-control rounded-0 readonly" value="srtt01@smartreading.com" disabled readonly></td>
                    <td class="td-state"><span>完成</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 表格  end  --> 
          <!-- 學生名單  end  -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal#studentListsModal 學生名單  end  --> 

<!-- Modal#sessionSetModal 場次設定 start -->
<div class="modal fade" id="sessionSetModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="sessionSetModal" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-0">
      <div class="modal-header">
        <button type="button" class="btn-close float-start" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row px-2 justify-content-center">
          <!-- 場次設定 start -->
          <div class="mb-3 row">
            <h3 class="text-center h6">場次設定</h3>
          </div>
          <div class="SRform mb-4 col-lg-10 mx-auto" id="">
            <div class="mb-3 row align-items-center">
              <label for="updateSessionName" class="col-sm-4 col-form-label text-sm-end">場次名稱<span class="text-red">*</span></label>
              <div class="col-sm-6">
                <input type="text" class="form-control rounded-0" id="updateSessionName" value="2020-21">
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <label for="updateRemark" class="col-sm-4 col-form-label text-sm-end" value="zhanghuahua">場次備註</label>
              <div class="col-sm-6">
                <input type="text" class="form-control rounded-0" id="updateRemark" value="淡水國小">
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <label for="updateStartTime" class="col-sm-4 col-form-label text-sm-end">開始時間<span class="text-red">*</span></label>
              <div class="col-sm-6">
                <input type="datetime-local" class="form-control rounded-0" id="updateStartTime" value="2012-09-01T08:00">
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <label for="updateEndTime" class="col-sm-4 col-form-label text-sm-end">結束時間<span class="text-red">*</span></label>
              <div class="col-sm-6">
                <input type="datetime-local" class="form-control rounded-0" id="updateEndTime" value="2012-09-02T17:30">
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <label for="updateState" class="col-sm-4 col-form-label text-sm-end">狀態</label>
              <div class="col-sm-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="updateState">
                </div>
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <div class="col-sm-6 offset-sm-4">
                <div class="text-red text-center fs-8 mb-n2" id="updateSessionMsg">
                  <!--錯誤訊息在這-->
                </div>
              </div>
            </div>
            <div class="mb-3 row align-items-center">
              <div class="col-sm-6 offset-sm-4 text-center">
                <button type="button" class="btn btn-outline-primary m-1" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary m-1" id="updateSession">儲存設定</button>
              </div>
            </div>
          </div>
          <!-- 場次設定  end  -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal#sessionSetModal 場次設定  end  -->

<footer> </footer>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="Content/js/jquery-3.6.0.min.js"></script> 

<!-- widgets JS --> 
<script src="Content/js/bootstrap.bundle.min.js"></script> 
<script src="Content/widgets/DataTables/datatables.min.js"></script> 
<script src="Content/js/doubleScorollbar.js"></script> 

<!-- my JS --> 
<script src="Content/js/main.js"></script> 
<script>
$(document).ready(function() {    
    //call header、footer、 sidebar  
    $('header').load('header.html', function(){
        //當前頁名稱顯示
        $('#currentPage').text( $('main h2').text() ).addClass('active'); 
    }); 
    $('footer').load('footer.html'); 
    $('#sidebarMenu').load('sidebar.html', function(){
        //當前頁actvie
        $('#sidebarMenu .nav-link[href*="DACC-session"]').addClass('active');   
    }); 
    
    const list = $('#sessionLists');

    //datatables 
	list.DataTable({
        //serverSide: true,
        order: [],  //取消默認排序icon
        ordering: false,
        autoWidth: false,
        responsive: false,
		searching: true,
		pageLength: 10,
		pagingType: "simple_numbers",
        dom: '<r<"table-responsive"t>>'+
			 '<"datatables-custom-footer clearfix"pi>',
        language: {
          url: 'Content/widgets/DataTables/lang/Chinese-traditional.json'
        },
        ajax: 'Content/json/testMgt-session/sessionLists.json',
        columnDefs: [
            {//序號
                targets: 0, 
                title: '序號',
                width: '4%',
                className: 'td-no',
                type: 'numeric',
                render: function (data, type, row, meta) {
                    return meta.row + 1; 
                } 
            },
            {//場次
                targets: 1, 
                title: '場次',
                data: 'session',
                width: '12%',
                className: 'td-session', 
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//備註
                targets: 2, 
                title: '備註',
                data: 'remark',
                width: '12%',
                className: 'td-remark',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//開始時間 
                targets: 3,
                title: '開始時間',
                data: 'startTime',
                width: '16%',
                className: 'td-startTime',
                type: 'date',
            },
            {//結束時間
                targets: 4, 
                title: '結束時間',
                data: 'endTime',
                width: '16%',
                className: 'td-endTime',
                type: 'date',
            },
            {//測驗人數
                targets: 5, 
                title: '測驗人數',
                data: 'testNum',
                width: '8%',
                className: 'td-testNum',
                type: 'numeric',
            },
            {//完成人數
                targets: 6, 
                title: '完成人數',
                data: 'doneNum',
                width: '8%',
                className: 'td-doneNum',
                type: 'numeric',
            },
            {//功能操作
                targets: 7, 
                title: '功能操作',
                width: '14%',
                className: 'td-tools',
                type: 'html',
                render: function (data, type, row, meta) {
                    return `<button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-studentSet" data-bs-toggle="tooltip"><img src="Content/images/icon-user-add.svg" alt="button studentSet image"/></button>
                  <button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-studentLists" data-bs-toggle="tooltip"><img src="Content/images/icon-paper.svg" alt="button studentLists image"/></button>
                  <button type="button" class="btn btn-outline-primary bg-gradient my-1 px-1 btn-session-sessionSet" data-bs-toggle="tooltip"><img src="Content/images/icon-tool.svg" alt="button sessionSet image"/></button>`;
                }
            },
            {//狀態
                targets: 8, 
                title: '狀態',
                data: 'state',
                width: '10%',
                className: 'td-state',
                type: 'html',
                render: function (data, type, row, meta) {
                    let state;
                    switch (data) {
                        case 'ON':
                            state = `<div class="form-check form-switch form-check-inline m-0">
                                        <input class="form-check-input readonly" type="checkbox" role="switch" checked disabled>
                                      </div>`;
                            break
                        case 'OFF':
                            state = `<div class="form-check form-switch form-check-inline m-0">
                                        <input class="form-check-input readonly" type="checkbox" role="switch" disabled>
                                      </div>`;
                            break    
                        default:
                            state = '';
                            break 
                    }
                    return state;
                } 
            }
        ],
        initComplete: function() {
            //datatable footer input page
            datatableInputPage(list);
            
            //Enable tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl, {
                placement: 'bottom',
                title: function (){
                    if( $(this).hasClass('btn-session-studentSet') ){
                        return '設定學生';  
                    }else if( $(this).hasClass('btn-session-studentLists') ){
                        return '學生名單';      
                    }else if( $(this).hasClass('btn-session-sessionSet') ){
                        return '場次設定'; 
                    } 
                }
            }));
        }
    });

    //[搜尋]
    $('#btnSearch').click(function(){  console.log($('#searchKeywords').val());
        list.DataTable().search( $('#searchKeywords').val() ).draw();                
    }); 
    //[搜尋][X]重置
    $('#searchKeywords + .btn-close').click(function(){ 
        list.DataTable().search('').draw();                                    
    }); 
    
    //[新增場次]
    $('#insert').click(function(){
        $('#insertModal').modal('show');
    });
    //[新增場次]-[確定新增]
    $('#insertSession').click(function(){
        let insertOk = true; //[true | false] [成功 | 失敗]
        
        //demo驗證
        let errorText = '';
        let validationField = '#insertSessionName, #insertStartTime, #insertEndTime';
        
        //demo偵測欄位是否為空值
        $(validationField).each(function(){
            if( $(this).val().trim() == '' ){
                $(this).addClass('empty invalid');
            }else {
                $(this).removeClass('empty invalid');
            }
        });
        
        //demo錯誤訊息內容
        if( $(validationField).hasClass('empty') ){
             errorText += '*號為必填欄位<br>';    
        }
        
        //demo是否有錯誤訊息、驗證是否成功
        if (errorText != ''){
            insertOk = false;  
        }else{
            insertOk = true;    
        }
        
        if(insertOk == true){ //新增成功
            $('#insertSessionMsg').html('');
            $('#insertModal').find('input, select').removeClass('empty invalid');
            
            alertModal('<div class="text-red">新增成功！</div>');
            
            $('#alertModal').on('hidden.bs.modal', function(){
                //清空表單
                $('#insertModal').find('input, select').val('');
                $('#insertModal').find('input[type="radio"]').prop('checked', false);
                
                $('#insertBat').attr('disabled', true);    
            });    
        }else{//新增失敗
            $('#insertSessionMsg').html(errorText); 
        }
    });

    /////////////////////////////////////////////////
    
    //[設定學生]
    list.on('click', '.btn-session-studentSet', function (){
        $('#studentSetModal').modal('show');
        
        //do something... (取得sessionLists行列項目資料)
        
        $('#studentSetModal').on('shown.bs.modal', function(){
            loadStudentSetDOM();
        });
    });
    //[設定學生]DOM
    function loadStudentSetDOM(){  
        $.getJSON('Content/json/testMgt-session/studentSet.json', function (data) {
            let gradeArray = data.data;   
            let accordionHTML = '';
            
            for (let i=0; i<gradeArray.length; i++){ //X年級
                let classArray = gradeArray[i].table; 
                let tableHTML = '';

                for (let j=0; j<classArray.length; j++){ //X班  
                    let stuArray = classArray[j].students; 
                    let tbodyHTML = '';
                    
                    for (let k=0; k<stuArray.length; k++){ //學生  
                        tbodyHTML += `<tr>
                                          <td class="td-classCheck"><div class="SRform-check-red">
                                              <input class="form-check-input" type="checkbox" name="check">
                                            </div></td>
                                          <td class="td-Cname"><input type="text" class="form-control rounded-0 readonly" value="`+ stuArray[k].Cname +`" disabled readonly></td>
                                          <td class="td-Sid"><input type="text" class="form-control rounded-0 readonly" value="`+ stuArray[k].Sid +`" disabled readonly></td>
                                          <td class="td-account"><input type="text" class="form-control rounded-0 readonly" value="`+ stuArray[k].account +`" disabled readonly></td>
                                        </tr>`;    
                    }
                    
                    tableHTML += `<div class="table-responsive">
                                    <table class="table table-bordered SRtable mb-0 table-studentSet checkbox-parent" id="studentSet`+gradeArray[i].grade+`-`+j+`">
                                      <thead class="checkbox-input">
                                        <tr>
                                          <th scope="col" class="td-classCheck"> <button class="table-collapse collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#studentSet`+gradeArray[i].grade+`-`+j+`-tbody" aria-expanded="false" aria-controls="studentSet`+gradeArray[i].grade+`-`+j+`-tbody">
                                            <span class="form-check-inline SRform-check-red me-2">
                                            <input class="form-check-input" type="checkbox" name="checkAll">
                                            </span>`+ classArray[j].class +`班
                                            </button>
                                          </th>
                                          <th scope="col" class="td-Cname">姓名</th>
                                          <th scope="col" class="td-Sid">學號</th>
                                          <th scope="col" class="td-account">帳號/信箱</th>
                                        </tr>
                                      </thead>
                                      <tbody class="collapse checkbox-children" id="studentSet`+gradeArray[i].grade+`-`+j+`-tbody">
                                        `+ tbodyHTML +`
                                      </tbody>
                                    </table>
                                   </div>`;
                }
                                                   
                accordionHTML += `<div class="accordion-item checkbox-parent">
                                        <h4 class="accordion-header checkbox-input">
                                          <button class="accordion-button collapsed bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapse`+ gradeArray[i].grade +`" aria-expanded="false" aria-controls="collapse`+ gradeArray[i].grade +`">
                                          <span class="form-check-inline SRform-check-red me-2">
                                          <input class="form-check-input my-0" type="checkbox" name="checkAll">
                                          </span>`+ gradeArray[i].grade +`年級
                                          </button>
                                        </h4>
                                        <div id="collapse`+ gradeArray[i].grade +`" class="accordion-collapse collapse checkbox-children">
                                          <div class="accordion-body p-0"> 
                                            `+ tableHTML +`
                                          </div>
                                        </div>
                                      </div>`; 
            }
            
            //$('#accordionStudentSet').html(accordionHTML);
            
            checkboxFun();
        });    
    }
    //[設定學生]checkbox 
    function checkboxFun(){
        //全選
        $('input[name="checkAll"]').change(function(){
            let parents = $(this).closest('.checkbox-parent');
            let children = parents.find('.checkbox-children');

            var checkboxes = children.find('input[type="checkbox"]:checkbox');
            $(this).is(':checked') ? checkboxes.prop('indeterminate', false) : checkboxes.prop('indeterminate', false);
            $(this).is(':checked') ? checkboxes.prop('checked', true) : checkboxes.prop('checked', false);
        }); 
        
        //反選
        $('input[type="checkbox"]').change(function(){
            if( $(this).parents('.checkbox-children').length > 0 ){
                let checkedBox = $(this).closest('.checkbox-children').find('input[type="checkbox"]:checked' ),
                    allBox     = $(this).closest('.checkbox-children').find('input[type="checkbox"]:checkbox'),
                    targetBox  = $(this).closest('.checkbox-children')
                                        .prev('.checkbox-input').find('input[name="checkAll"]');
                
                //targetBox.css('background', 'rgba(255,0,0,.1)');
                
                if ( checkedBox.length == allBox.length ) {//console.log('這群全選'+checkedBox.length+'/'+allBox.length); 
                    targetBox.prop({
                        indeterminate: false, 
                        checked: true
                    });  
                } else {
                    if( checkedBox.length == 0){//console.log('這群全沒選'+checkedBox.length+'/'+allBox.length);
                        targetBox.prop({
                            indeterminate: false, 
                            checked: false
                        });                                
                    }else{    //console.log('這群各自選'+checkedBox.length+'/'+allBox.length);  
                        targetBox.prop({    
                            indeterminate: true, 
                            checked: false
                        });    
                    }
                    
                    //上層是否有渠選
                    /*targetBox.closest('.checkbox-children')
                             .prev('.checkbox-input').find('input[name="checkAll"]')
                             .prop({    
                                indeterminate: true, 
                                checked: false
                             });*/
                }
                //console.log('===============')
            }
        });
    }

    /////////////////////////////////////////////////
    
    //[學生名單]datatables 
    $('#sessionStudentLists').DataTable({
        //serverSide: true,
        order: [],  //取消默認排序icon
        ordering: false,
        autoWidth: false,
        responsive: false,
        searching: true,
        pageLength: 10,
        pagingType: "simple_numbers",
        dom: '<r<"table-responsive"t>>'+
             '<"datatables-custom-footer clearfix"pi>',
        language: {
          url: 'Content/widgets/DataTables/lang/Chinese-traditional.json'
        },
        //ajax: 'Content/json/testMgt-session/sessionStudentLists.json',
        columnDefs: [
            {//序號
                targets: 0, 
                title: '序號',
                width: '8%',
                className: 'td-no',
                type: 'numeric',
                render: function (data, type, row, meta) {
                    return meta.row + 1; 
                } 
            },
            {//年級
                targets: 1, 
                title: '年級',
                data: 'grade',
                width: '10%',
                className: 'td-grade', 
                type: 'numeric',
            },
            {//班級
                targets: 2, 
                title: '班級',
                data: 'class',
                width: '12%',
                className: 'td-class',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//姓名 
                targets: 3,
                title: '姓名',
                data: 'Cname',
                width: '13%',
                className: 'td-Cname',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//學號
                targets: 4, 
                title: '學號',
                data: 'Sid',
                width: '13%',
                className: 'td-Sid',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//帳號/信箱
                targets: 5, 
                title: '帳號/信箱',
                data: 'account',
                width: '34%',
                className: 'td-account',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//狀態
                targets: 6, 
                title: '狀態',
                data: 'state',
                width: '10%',
                className: 'td-state',
                type: 'html',
                orderDataType: 'dom-text',
                render: function (data, type, row, meta) {
                    let state;
                    switch (data) {
                        case '0':
                            state = `<span class="text-red">未完成</span>`;
                            break
                        case '1':
                            state = `<span>完成</span>`;
                            break    
                        default:
                            state = '';
                            break 
                    }
                    return state;
                } 
            }

        ],
        initComplete: function() {
            //datatable footer input page
            datatableInputPage($('#sessionStudentLists'));
        }
    }); 
    //[學生名單]
    list.on('click', '.btn-session-studentLists', function (){
        $('#studentListsModal').modal('show');
        
        //do something... (取得sessionLists行列項目資料)
        
        $('#studentListsModal').on('shown.bs.modal', function(){ 
            $('#sessionStudentLists').DataTable().ajax.url('Content/json/testMgt-session/sessionStudentLists.json').load();    
        });
    });
    //[學生名單] > [搜尋]
    $('#btnSearch_studentLists').click(function(){  
        $('#sessionStudentLists').DataTable().search( $('#searchKeywords_studentLists').val() ).draw();                
    }); 
    //[學生名單] > [搜尋][X]重置
    $('#searchKeywords_studentLists + .btn-close').click(function(){ 
        $('#sessionStudentLists').DataTable().search('').draw();                                    
    });
    //[學生名單] - checkbox只能擇一 - 搜尋
    $('input[name="showList"]').click(function() {
        if( $(this).prop('checked') ){
            $('.SRform-check input:checkbox').prop('checked', false);
            $(this).prop('checked', true);

            //$('#sessionStudentLists').DataTable().column('.td-state').search('<span class="text-red">未完成</span>', true, true).draw();
        }
    });  

    /////////////////////////////////////////////////
    
    //[場次設定]
    list.on('click', '.btn-session-sessionSet', function (){
        $('#sessionSetModal').modal('show');
        
        //do something... 取得表格值
    });
    //[場次設定] > [儲存設定]
    $('#updateSession').click(function(){
        let updateOk = true; //[true | false] [成功 | 失敗]
        
        //demo驗證
        let errorText = '';
        let validationField = '#updateSessionName, #updateStartTime, #updateEndTime';
        
        //demo偵測欄位是否為空值
        $(validationField).each(function(){
            if( $(this).val().trim() == '' ){
                $(this).addClass('empty invalid');
            }else {
                $(this).removeClass('empty invalid');
            }
        });
        
        //demo錯誤訊息內容
        if( $(validationField).hasClass('empty') ){
             errorText += '*號為必填欄位<br>';    
        }
        
        //demo是否有錯誤訊息、驗證是否成功
        if (errorText != ''){
            insertOk = false;  
        }else{
            insertOk = true;    
        }
        
        if(insertOk == true){ //新增成功
            $('#updateSessionMsg').html('');
            $('#sessionSetModal').find('input, select').removeClass('empty invalid');
            
            alertModal('<div class="text-red">儲存成功！</div>'); 
            
            $('#alertModal').on('hidden.bs.modal', function(){
                //關閉modal
                $('#sessionSetModal').modal('hide');
            }); 
        }else{//新增失敗
            $('#updateSessionMsg').html(errorText); 
        }
    });   
}); 
</script>
</body>
</html>
