<!doctype html>
<html lang="zh-hant-TW">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="smartreading-XXXX">
<meta name="author" content="smartreading">
<meta name="generator" content="smartreading">
<title>SmartReading 教師端</title>
<link rel="shortcut icon" type="image/x-icon" href="Content/images/favicon.ico">
<!-- google fonts -->	
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">	
	
<!-- widgets CSS -->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
<link rel="stylesheet" type="text/css" href="Content/widgets/DataTables/datatables.min.css">

<!-- template CSS -->
<link rel="stylesheet" type="text/css" href="Content/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="Content/css/SRv3-manager.css">
</head>
<body>
<header> </header>
    
<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-xl-2 d-xl-block bg-white sidebar collapse"> </nav>
    <main class="col-xl-10"> 
      <!-- ------- ------- ------- ------- ------- ------- ------- -->
      <h2>檢視學校報表</h2>
      <!-- 學生資訊/班級資訊-頁籤 start -->
      <div class="row">
        <ul class="nav nav-viewinfo-school">
          <li class="nav-item"> <a class="nav-link active" aria-current="page" href="DACC-schoolReport-student.html">學生資訊</a> </li>
          <li class="nav-item"> <a class="nav-link" href="DACC-schoolReport-class.html">班級資訊</a> </li>
        </ul>
      </div>
      <!-- 學生資訊/班級資訊-頁籤 end  --> 
      
      <!-- 學生中文閱讀能力適性診斷評量報表 start -->
      <div class="row py-3 py-xl-5 px-1 px-xl-4">
        <h3 class="h5 text-center mb-4">學生中文閱讀能力適性診斷評量報表</h3>
        <!-- 搜尋 start -->
        <div class="col-xl-12 mb-5 mt-1" id="blockSearch">
          <div class="row align-items-center justify-content-center">
            <div class="col-auto">
              <div class="row gy-1">
                <div class="col-auto">
                  <div class="row g-2 align-items-center">
                    <div class="col-auto"> <label for="searchSessions" class="col-form-label fs-8">測驗場次</label> </div>
                    <div class="col-auto">
                      <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchSessions">
                        <option value="" disabled selected>請選擇...</option>
                        <option value="2023/03/24,2023/06/30">2023 Demo</option>
                      </select>
                    </div>
                  </div>
                </div> 
                <div class="col-auto">
                  <div class="row g-2 align-items-center">
                    <div class="col-auto"> <label for="searchGrade" class="col-form-label fs-8">年級</label> </div>
                    <div class="col-auto">
                      <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchGrade">
                        <option value="" disabled selected>請選擇...</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                      </select>
                    </div>
                  </div>
                </div>  
                <div class="col-auto">
                  <div class="row g-2 align-items-center">
                    <div class="col-auto"> <label for="searchDimension" class="col-form-label fs-8">向度選擇</label> </div>
                    <div class="col-auto">
                      <select class="form-select rounded-0 form-select-sm form-select-arrow-sm" id="searchDimension">
                        <option value="" disabled selected>請選擇...</option>
                        <option value="DACCall">整體閱讀理解能力</option>
                        <option value="DACCword">字詞辨識</option>
                        <option value="DACCsuperficial">表層文意理解</option>
                        <option value="DACCtextual">文意統整</option>
                        <option value="DACCinference">推論理解</option>
                        <option value="DACCanalysis">分析評鑑</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="col-auto">
                  <div class="row g-2 align-items-center">
                    <div class="col-auto"><label class="fs-8">時間：</label></div>
                    <div class="col-auto"><span class="fs-8"><label id="searchStartDate">----/--/--</label>至<label id="searchEndDate">----/--/--</label></span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 搜尋  end  --> 
        <!-- *評量區域 start -->
        <div class="col-xl-12 mb-5 studentAssessmentBlock" id="">
          <h4 class="h6 mb-3"><a href="#" role="button" data-bs-toggle="popover"><span class="icon"></span><span id="dimensionTitle">向度</span><i class="fa-regular fa-circle-question"></i></a></h4>
          <div class="row align-items-center">
            <div class="col-lg-10 mx-auto col-xl-6 col-xxl-5 mb-3">
              <table class="table table-bordered SRtable mb-0 table-studentAssessment" id="">
                <thead>
                  <tr>
                    <th scope="col" class="td-name">標準名稱</th>
                    <th scope="col" class="td-value">標準對應值</th>
                    <th scope="col" class="td-percentage">百分占比</th>
                    <th scope="col" class="td-num">人數</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-name bg-advanced">進階<small>Advanced</small></td>
                    <td class="td-value">---</td>
                    <td class="td-percentage">---</td>
                    <td class="td-num">---</td>
                  </tr>
                  <tr>
                    <td class="td-name bg-proficient">熟讀<small>Proficient</small></td>
                    <td class="td-value">---</td>
                    <td class="td-percentage">---</td>
                    <td class="td-num">---</td>
                  </tr>
                  <tr>
                    <td class="td-name bg-basic">基礎<small>Basic</small></td>
                    <td class="td-value">---</td>
                    <td class="td-percentage">---</td>
                    <td class="td-num">---</td>
                  </tr>
                  <tr>
                    <td class="td-name bg-belowBasic">基礎之下<small>Below Basic</small></td>
                    <td class="td-value">---</td>
                    <td class="td-percentage">---</td>
                    <td class="td-num">---</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="4"> 總人數：<label>---</label>人 </td>
                  </tr>
                </tfoot>
              </table>
            </div>
            <div class="col-lg-10 mx-auto col-xl-6 col-xxl-7 px-xxl-5 mb-3">
              <canvas id="chart-studentAssessment"></canvas>
            </div>
          </div>
        </div>
        <!-- *評量區域  end  --> 
        <!-- *名單區域 start -->
        <div class="col-xl-10 mx-auto studentListBlock">
          <h4 class="h6 text-center mb-4"><label>整體閱讀理解能力</label>報表名單</h4>
          <!-- 進階 Advanced start -->
          <h5 class="bg-advanced">進階<small>Advanced</small></h5>
          <div class="row gx-2 mb-3">
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Advanced-1">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Advanced-2">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 進階 Advanced  end  --> 
          <!-- 熟練 Proficient start -->
          <h5 class="bg-proficient">熟練<small>Proficient</small></h5>
          <div class="row gx-2 mb-3">
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Proficient-1">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Proficient-2">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 熟練 Proficient  end  --> 
          <!-- 基礎 Basic start -->
          <h5 class="bg-basic">基礎<small>Basic</small></h5>
          <div class="row gx-2 mb-3">
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Basic-1">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-Basic-2">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 基礎 Basic  end  --> 
          <!-- 基礎之下 Below Basic start -->
          <h5 class="bg-belowBasic">基礎之下<small>Below Basic</small></h5>
          <div class="row gx-2 mb-3">
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-BelowBasic-1">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-xl-6">
              <table class="table table-bordered SRtable table-studentList" id="studentList-BelowBasic-2">
                <thead>
                  <tr>
                    <th scope="col" class="td-class">班級</th>
                    <th scope="col" class="td-name">學生姓名</th>
                    <th scope="col" class="td-SR">SR分數</th>
                    <th scope="col" class="td-DACC"><a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="td-class"><input type="text" class="form-control rounded-0 readonly" value="2" disabled readonly></td>
                    <td class="td-name"><input type="text" class="form-control rounded-0 readonly" value="張花花" disabled readonly></td>
                    <td class="td-SR">336</td>
                    <td class="td-DACC">4</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- 基礎之下 Below Basic  end  --> 
        </div>
        <!-- *名單區域  end  --> 
      </div>
      <!-- 學生中文閱讀能力適性診斷評量報表  end  --> 
      <!-- ------- ------- ------- ------- ------- ------- ------- --> 
    </main>
  </div>
</div>
    
<footer> </footer>
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<!-- ------- ------- ------- ------- ------- ------- ------- --> 
<script src="Content/js/jquery-3.6.0.min.js"></script> 

<!-- widgets JS --> 
<script src="Content/js/bootstrap.bundle.min.js"></script> 
<script src="Content/widgets/DataTables/datatables.min.js"></script> 
<script src="Content/js/doubleScorollbar.js"></script> 
    
<script src="Content/widgets/Chart.js-master/chart.js"></script> 

<!-- my JS --> 
<script src="Content/js/main.js"></script> 
<script>
$(document).ready(function() {
    //call header、footer、 sidebar  
    $('header').load('header.html', function(){
        //當前頁名稱顯示
        $('#currentPage').text( $('main h2').text() ).addClass('active'); 
    });
    $('footer').load('footer.html'); 
    $('#sidebarMenu').load('sidebar.html', function(){
        //當前頁actvie
        $('#sidebarMenu .nav-link[href*="DACC-schoolReport"]').addClass('active');   
    }); 
    
    //清空table
    $('.table-studentList').find('tbody').remove();
    
    //chart plugins [customAxisTitle]
    const customAxisTitle = {
        id: 'customAxisTitle',
        afterDraw: (chart, args, options) => { 
            const {ctx, 
                   chartArea: {top, bottom, left, right},
                   scales: {x, y}
                  } = chart;
            
            ctx.save();
            
            ctx.font = '15px';
            ctx.fillStyle = Chart.defaults.color;
            ctx.fillText(options.xText, right + 10, bottom + 5);
            ctx.fillText(options.yText, left - 15, top - 25);
            
            ctx.restore();
        }    
    }
    
    //chart plugins [canvasAxislonger]
    const canvasAxislonger = {
        id: 'canvasAxislonger',
        afterDraw: (chart, args, options) => { 
            const {ctx, 
                   chartArea: {top, bottom, left, right},
                   scales: {x, y}
                  } = chart;
            
            ctx.save();
            
            ctx.fillStyle = Chart.defaults.borderColor;
            
            //y上方線
            ctx.fillRect(left - 1, top - 15, 1, 15);    
            
            ctx.restore();
        }    
    }
    
    //chart.js
    const ctx = document.getElementById('chart-studentAssessment');
    
    Chart.defaults.backgroundColor = '#ffffff';
    Chart.defaults.borderColor     = '#C6C6C6';
    Chart.defaults.color           = '#5c6466';
    Chart.defaults.font.size       = 14;

    let myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['基礎之下', '基礎', '熟讀', '進階'],
            datasets: [{
                barPercentage: 0.7,
                data: [],  
            }]
        },
        options: {
            layout: {
                padding: {
                    top: 40,
                    right: 50,
                }
            }, 
            elements: {
                bar: {
                    backgroundColor: ['#ff5252', '#ff912f', '#f4da00', '#00d587'],
                }
            },  
            scales: {
                x: {
                    title: {
                        display: false,
                    }, 
                    grid: {
                        display: false
                    }
                },
                y: {
                    title: {
                        display: false,
                    },
                    grid: {
                        tickColor: 'white'
                    },
                    ticks: {
                        count: 6,
                        stepSize: 100  
                    }
                }  
            },
            plugins: {
                legend: false, 
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return ' ' + context.parsed.y + '人';
                        }
                    }
                },
                customAxisTitle:{
                    xText: '等級',
                    yText: '人數',
                }
            } 
        },
        plugins: [customAxisTitle, canvasAxislonger]
    });
    
    //向度報表名單 datatables 
	$('.table-studentList').DataTable({
        //serverSide: true,
        order: [],  //取消默認排序icon
        ordering: false,
        autoWidth: false,
        responsive: false,
		searching: true,
		pageLength: 10,
		pagingType: "simple_numbers",
        dom: '<r<"table-responsive"t>>',
        language: {
          url: 'Content/widgets/DataTables/lang/Chinese-traditional.json'
        },
        //ajax: 'Content/json/testMgt-schoolReport/schoolStudents.json',
        columnDefs: [
            {//班級
                targets: 0, 
                title: '班級',
                data: 'class',
                width: '8%',
                className: 'td-class',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                }
            },
            {//姓名
                targets: 1, 
                title: '姓名',
                data: 'Cname',
                width: '8%',
                className: 'td-Cname',
                orderDataType: 'dom-text',
                type: 'string',
                render: function (data, type, row, meta) {
                    return `<input type="text" class="form-control rounded-0 readonly" value="` + data + `" disabled readonly>`;
                } 
            },
            {//SR分數
                targets: 2, 
                title: 'SR分數',
                data: 'SR',
                width: '5%',
                className: 'td-SR',
                type: 'numeric',
            },
            {//DACC等級
                targets: 3, 
                title: '<a href="#" role="button" data-bs-toggle="popover" class="popover-DACClevel">DACC等級<i class="fa-regular fa-circle-question"></i></a>',
                data: 'DACClevel',
                width: '5%',
                className: 'td-DACC',
                type: 'numeric',
            }
        ]
    });
    
    //demo下拉搜尋
    $('#blockSearch select').each(function(){
        $(this).change(function(){
            let dimensionVal = $('#searchDimension option:selected').val(),
                dimensionText = $('#searchDimension option:selected').text(),
                gradeVal = $('#searchGrade option:selected').val(),
                sessionVal = $('#searchSessions option:selected').val(),
                sessionText = $('#searchSessions option:selected').text().replace(/\s/g,'');

            //選擇[測驗場次]後，顯示時間
            if( $(this).attr('id') == 'searchSessions' ){
                let sessionArray = sessionVal.split(',');  
                $('#searchStartDate').text(sessionArray[0]);
                $('#searchEndDate').text(sessionArray[1]);
            }
            
            //選擇[測驗場次]後，是否有要更新[年級]的選單，使之僅顯示有參與的年級？請工程師判定後處理。
            /*原因：怕無資料，使用者看無畫面更動會以為壞掉... 
                   或可解決辦法：跳出訊息alertModal(html)告知無資料*/
            
            //選擇[向度選擇][年級][測驗場次]後，更新圖表
            if( dimensionVal && gradeVal && sessionVal ){
                //顯示圖表標題
                $('.studentAssessmentBlock').attr('id', dimensionVal);
                $('#dimensionTitle').text(dimensionText); 
                $('.studentListBlock h4 label').text(dimensionText);
                
                $.getJSON('Content/json/testMgt-schoolReport/schoolStudents.json', function (data) {
                    //基礎之下數據
                    let filterBelowBasic = $.grep(data.data, function(item) {
                        return item.standard === 'Below Basic';
                    });
                    //基礎數據
                    let filterBasic = $.grep(data.data, function(item) {     
                        return item.standard === 'Basic';
                    });
                    //熟讀數據
                    let filterProficient = $.grep(data.data, function(item) {
                        return item.standard === 'Proficient';
                    });
                    //進階數據
                    let filterAdvanced = $.grep(data.data, function(item) {  
                        return item.standard === 'Advanced';
                    });
                    
                    let total           = data.data.length;         //總人數
                    let totalBelowBasic = filterBelowBasic.length;  //基礎之下人數 
                    let totalBasic      = filterBasic.length;       //基礎人數
                    let totalProficient = filterProficient.length;  //熟讀人數
                    let totalAdvanced   = filterAdvanced.length;    //進階人數

                    //表格數據 - 標準對應值
                    $.getJSON('Content/json/testMgt-schoolReport/boxplotQ.json', function (data) {
                        var cutPoint = [];

                        $.each(data.data, function(index, item) {
                          if (item.dimension === dimensionVal) {
                            $.each(item.content, function(i, contentItem) {
                              if (contentItem.grade === parseInt(gradeVal)) {
                                cutPoint = contentItem.cut;
                                return false;
                              }
                            });
                          }
                        });
                       
                        $('.table-studentAssessment tbody tr:nth-child(4) .td-value')
                            .text('≤' + cutPoint[0]); //基礎之下
                        $('.table-studentAssessment tbody tr:nth-child(3) .td-value')
                            .text(cutPoint[0] + '-' + cutPoint[1]);//基礎
                        $('.table-studentAssessment tbody tr:nth-child(2) .td-value')
                            .text(cutPoint[1] + '-' + cutPoint[2]);//熟讀
                         $('.table-studentAssessment tbody tr:nth-child(1) .td-value')
                            .text('≥' + cutPoint[2]);//進階
                    });
                    
                    //表格數據 - 人數
                    $('.table-studentAssessment tbody tr:nth-child(4) .td-num').text(totalBelowBasic); //基礎之下       
                    $('.table-studentAssessment tbody tr:nth-child(3) .td-num').text(totalBasic);      //基礎
                    $('.table-studentAssessment tbody tr:nth-child(2) .td-num').text(totalProficient); //熟讀  
                    $('.table-studentAssessment tbody tr:nth-child(1) .td-num').text(totalAdvanced);   //進階
                    
                    //表格數據 - 百分占比
                    $('.table-studentAssessment tbody tr .td-percentage').text(
                        function(){
                            let perNum = $(this).next('.td-num').text() / total * 100;
                            
                            if (Number.isInteger(perNum)) {
                                return perNum.toFixed(0)+'%';
                            } else {
                                return perNum.toFixed(1)+'%';
                            }
                        }
                    );
                    
                    $('.table-studentAssessment tfoot label').text(total);
                    
                    //圖表數據 
                    myChart.data.datasets[0].data = [totalBelowBasic, totalBasic, totalProficient, totalAdvanced];
                    myChart.update();
                    
                    //報表名單
                    $('.table-studentList').each(function(){
                        let standardName = $(this).attr('id').split('-')[1];
                        let tableData = [];
                        switch (standardName){
                            case 'BelowBasic':
                                tableData = filterBelowBasic;
                                break;
                                
                            case 'Basic':
                                tableData = filterBasic;
                                break;
                                
                            case 'Proficient':
                                tableData = filterProficient;
                                break;
                                
                            case 'Advanced':
                                tableData = filterAdvanced;
                                break;
                                
                            default:
                                break;    
                        }
                        
                        studentListDatatable(standardName, tableData);
                    });     
                }); 
                
                //popovers
                var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
                var popoverList = popoverTriggerList.map(function (popoverTriggerList) {
                    return new bootstrap.Popover(popoverTriggerList, {
                        container: 'body',
                        html: true,
                        placement: 'right',
                        trigger: 'hover focus',
                        content: function (){
                            if ( $(this) && $(this).hasClass('popover-DACClevel') ) {  
                                return 'DACC等級分為 1~13 級。DACC等級5，意指閱讀能力有五年級的平均水準，等級7則是閱讀能力有七年級的平均水準，以此類推。<br>DACC最高等級為13，意即閱讀能力超過12年級，已具備就讀大專院校的閱讀能力。';
                            } else {
                                switch ( $(this).parents('.studentAssessmentBlock').attr('id') ){
                                    //整體閱讀理解能力
                                    case 'DACCall':
                                        return '是指讀者不僅能正確瞭解文章裡字、詞、句的意思，理解作者在文章裡所明白敘述的訊息，而且還能運用已有的生活經驗或知識，解讀作者在文章裡沒有直接敘述的訊息、觀點，並能掌握文章的大意主旨。';
                                        break;

                                    //字詞辨識    
                                    case 'DACCword': 
                                        return '理解一個字或詞在文句裡的意思。';
                                        break;

                                    //表層文意理解    
                                    case 'DACCsuperficial': 
                                        return '理解文章裡某一個句子所要表達的表層意思；或是理解文意，並能在文章裡找到特定的訊息。';
                                        break;

                                    //文意統整    
                                    case 'DACCtextual': 
                                        return '統整文章中整體的訊息，瞭解文章的大意及所要傳達的主旨。';
                                        break;

                                    //推論理解
                                    case 'DACCinference': 
                                        return '運用已有的生活經驗或知識，理解、推敲作者在文章裡沒有直接敘述的訊息或觀點。';
                                        break;

                                    //分析評鑑    
                                    case 'DACCanalysis': 
                                        return '建構對文章深層的理解，評斷文章的品質，掌握文章觀點及寫作手法，客觀地評估文章適當的標題和類別。';
                                        break;  

                                    default:
                                        break;   
                                }
                            }
                        }
                    });
                }); 

                $(popoverTriggerList).click(function(e){
                    e.preventDefault();    
                });
            }
        });    
    });
    
    function studentListDatatable(name, data){   
        let divisible = data.length % 2, 
            cutNum    = Math.ceil(data.length/2), 
            plusNum   = 0,
            lastHtml;

        if( divisible === 0){//可被整除，雙數
            plusNum = 0;
            lastHtml = '';
        }else{               //不可被整除，單數
            plusNum = 1; 
            lastHtml = '<tr><td colspan="4">以下空白</td></tr>';
        }
        
        $('.table-studentList').DataTable().clear(); 
        
        if(data.length > 1){
            $('#studentList-' + name + '-1').DataTable().rows.add(data.slice(     0,      cutNum)).draw();
            $('#studentList-' + name + '-2').DataTable().rows.add(data.slice(cutNum, data.length)).draw();
            
            $('#studentList-' + name + '-2').find('tbody tr:last-child').after(lastHtml);
        }else{
            $('#studentList-' + name + '-1').DataTable().rows.add(data.slice(     0, data.length)).draw();
            $('td.dataTables_empty').text('以下空白');
        }
    }
});  
</script>
</body>
</html>
